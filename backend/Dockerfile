FROM node:20.11.0

WORKDIR /app

COPY . .

RUN npm install

ARG DB_URL
ARG CLOUDINARY_CLOUD_NAME
ARG CLOUDINARY_KEY
ARG CLOUDINARY_SECRET

RUN echo "DB_URL=${DB_URL}" > .env \
    && echo "CLOUDINARY_CLOUD_NAME=${CLOUDINARY_CLOUD_NAME}" >> .env \
    && echo "CLOUDINARY_KEY=${CLOUDINARY_KEY}" >> .env \
    && echo "CLOUDINARY_SECRET=${CLOUDINARY_SECRET}" >> .env

EXPOSE 80

CMD ["node", "server"]